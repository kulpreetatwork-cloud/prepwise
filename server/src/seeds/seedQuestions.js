import mongoose from 'mongoose';
import dotenv from 'dotenv';
import Question from '../models/Question.js';

dotenv.config();

const questions = [
  // Frontend - Technical
  { question: 'What is the Virtual DOM in React and how does it improve performance?', category: 'React', role: 'frontend', difficulty: 'easy', type: 'technical', idealAnswer: 'The Virtual DOM is a lightweight JavaScript representation of the real DOM. React creates a virtual copy, compares it with the previous version (diffing), and only updates the changed parts in the real DOM (reconciliation). This minimizes expensive DOM operations and improves performance.', tips: 'Mention diffing algorithm and reconciliation process.' },
  { question: 'Explain the difference between useEffect and useLayoutEffect in React.', category: 'React', role: 'frontend', difficulty: 'medium', type: 'technical', idealAnswer: 'useEffect runs asynchronously after the browser paints, while useLayoutEffect runs synchronously after DOM mutations but before the browser paints. useLayoutEffect is useful when you need to measure DOM elements or make visual changes before the user sees the update.', tips: 'Give examples of when each is appropriate.' },
  { question: 'What are React Server Components and how do they differ from Client Components?', category: 'React', role: 'frontend', difficulty: 'hard', type: 'technical', idealAnswer: 'React Server Components (RSC) render on the server and send HTML to the client with zero JavaScript bundle cost. They can directly access databases and file systems. Client Components handle interactivity with hooks and event handlers. RSC reduce bundle size and improve initial load time.', tips: 'Discuss the trade-offs and when to use each.' },
  { question: 'What is the difference between CSS Grid and Flexbox? When would you use each?', category: 'CSS', role: 'frontend', difficulty: 'easy', type: 'technical', idealAnswer: 'Flexbox is one-dimensional (row or column) and ideal for distributing space along a single axis. CSS Grid is two-dimensional (rows and columns simultaneously) and better for complex layouts. Use Flexbox for navigation bars, card rows; use Grid for page layouts, dashboards.', tips: 'Provide practical examples for each.' },
  { question: 'Explain closures in JavaScript with a practical example.', category: 'JavaScript', role: 'frontend', difficulty: 'medium', type: 'technical', idealAnswer: 'A closure is a function that retains access to its lexical scope even when executed outside that scope. Example: a counter function that returns an increment function - the inner function "closes over" the count variable. Closures enable data privacy, function factories, and callbacks.', tips: 'Use a real-world example like debounce or memoization.' },
  { question: 'How does the JavaScript event loop work? Explain microtasks vs macrotasks.', category: 'JavaScript', role: 'frontend', difficulty: 'hard', type: 'technical', idealAnswer: 'The event loop continuously checks the call stack and task queues. When the stack is empty, it processes all microtasks (Promises, MutationObserver) before handling the next macrotask (setTimeout, setInterval, I/O). This means Promise callbacks execute before setTimeout callbacks even if setTimeout has 0ms delay.', tips: 'Draw the execution order with a code example.' },
  { question: 'What are Web Vitals and how do you optimize them?', category: 'Performance', role: 'frontend', difficulty: 'medium', type: 'technical', idealAnswer: 'Core Web Vitals include LCP (Largest Contentful Paint), FID/INP (Interaction to Next Paint), and CLS (Cumulative Layout Shift). Optimize LCP with image optimization and preloading; improve INP by reducing main thread blocking; fix CLS by setting explicit dimensions for media elements.', tips: 'Mention specific tools like Lighthouse and Chrome DevTools.' },
  { question: 'How would you implement code splitting in a React application?', category: 'React', role: 'frontend', difficulty: 'medium', type: 'technical', idealAnswer: 'Use React.lazy() with Suspense for component-level splitting, dynamic import() for route-level splitting with React Router, and webpack/Vite chunk splitting configuration. This reduces initial bundle size by loading code on demand.', tips: 'Discuss the impact on user experience and loading states.' },

  // Backend - Technical
  { question: 'Explain the differences between SQL and NoSQL databases. When would you choose each?', category: 'Databases', role: 'backend', difficulty: 'easy', type: 'technical', idealAnswer: 'SQL databases (PostgreSQL, MySQL) are relational with structured schemas, ACID compliance, and complex joins. NoSQL (MongoDB, Redis) offers flexible schemas, horizontal scalability, and better performance for certain patterns. Choose SQL for complex relationships and transactions; NoSQL for flexibility, scale, and document-based data.', tips: 'Give specific use cases for each type.' },
  { question: 'What is the difference between authentication and authorization? How would you implement both?', category: 'Security', role: 'backend', difficulty: 'easy', type: 'technical', idealAnswer: 'Authentication verifies identity (who you are) - implemented via JWT, sessions, OAuth. Authorization determines permissions (what you can do) - implemented via role-based access control (RBAC), middleware checks, or policy-based systems. Both are essential layers of security.', tips: 'Mention specific implementation patterns and common pitfalls.' },
  { question: 'How do you handle rate limiting in a Node.js API?', category: 'APIs', role: 'backend', difficulty: 'medium', type: 'technical', idealAnswer: 'Implement rate limiting using middleware (express-rate-limit), token bucket or sliding window algorithms. Store counters in memory or Redis for distributed systems. Apply different limits per endpoint, user role, or IP. Return 429 status with Retry-After header.', tips: 'Discuss different algorithms and their trade-offs.' },
  { question: 'Explain microservices architecture and its pros and cons compared to monolith.', category: 'Architecture', role: 'backend', difficulty: 'hard', type: 'technical', idealAnswer: 'Microservices decompose an application into independent services communicating via APIs. Pros: independent scaling, technology flexibility, team autonomy, fault isolation. Cons: distributed system complexity, network latency, data consistency challenges, operational overhead. Start monolith, migrate to microservices when needed.', tips: 'Discuss when to use each architecture.' },
  { question: 'What is middleware in Express.js and how does the middleware chain work?', category: 'Node.js', role: 'backend', difficulty: 'easy', type: 'technical', idealAnswer: 'Middleware functions have access to request, response, and next() function. They execute sequentially in the order defined. Types include application-level, router-level, error-handling, and built-in middleware. The chain processes request through each middleware until a response is sent.', tips: 'Show practical examples of custom middleware.' },
  { question: 'How would you design a RESTful API for a social media platform?', category: 'APIs', role: 'backend', difficulty: 'hard', type: 'technical', idealAnswer: 'Design resources: /users, /posts, /comments, /likes. Use proper HTTP methods (GET, POST, PUT, DELETE). Implement pagination, filtering, sorting. Version the API (/v1/). Use proper status codes. Implement HATEOAS for discoverability. Consider GraphQL for complex data fetching patterns.', tips: 'Think about edge cases, pagination, and real-time features.' },

  // Full Stack - Technical
  { question: 'How would you implement real-time features in a web application?', category: 'Architecture', role: 'fullstack', difficulty: 'medium', type: 'technical', idealAnswer: 'Options include WebSockets (Socket.io) for bidirectional communication, Server-Sent Events for server-to-client streaming, long polling as a fallback. Choose based on needs: WebSockets for chat/gaming, SSE for notifications/feeds. Consider scaling with Redis pub/sub for multiple server instances.', tips: 'Compare the approaches and discuss scaling considerations.' },
  { question: 'Explain the concept of server-side rendering (SSR) vs client-side rendering (CSR) vs static site generation (SSG).', category: 'Architecture', role: 'fullstack', difficulty: 'medium', type: 'technical', idealAnswer: 'CSR renders in browser (React SPA) - fast interactions, poor SEO. SSR renders on server per request (Next.js) - good SEO, slower interactions. SSG pre-renders at build time - fastest, but not dynamic. ISR (Incremental Static Regeneration) combines SSG with periodic updates. Choose based on content dynamism and SEO needs.', tips: 'Discuss real-world scenarios for each approach.' },

  // Behavioral
  { question: 'Tell me about a time you had a conflict with a team member. How did you resolve it?', category: 'Teamwork', role: 'frontend', difficulty: 'medium', type: 'behavioral', idealAnswer: 'Use STAR method: Situation - describe the context. Task - what was your responsibility. Action - how you addressed the conflict through communication, compromise, or escalation. Result - positive outcome and what you learned. Show emotional intelligence and professional maturity.', tips: 'Be specific, show self-awareness, and focus on resolution.' },
  { question: 'Describe a project where you had to learn a new technology quickly. How did you approach it?', category: 'Learning', role: 'backend', difficulty: 'easy', type: 'behavioral', idealAnswer: 'Describe the situation and timeline pressure. Explain your learning strategy: documentation, tutorials, building small prototypes, asking experts. Show how you applied the new knowledge successfully. Emphasize adaptability and continuous learning mindset.', tips: 'Highlight your learning methodology and resourcefulness.' },
  { question: 'Tell me about a time you failed at something. What did you learn?', category: 'Self-awareness', role: 'fullstack', difficulty: 'medium', type: 'behavioral', idealAnswer: 'Share a genuine failure (not a humble brag). Use STAR method to describe what happened. Focus on what you learned and how you changed your approach. Show growth mindset and accountability. Demonstrate that you take calculated risks and learn from mistakes.', tips: 'Be honest and show genuine reflection.' },
  { question: 'How do you prioritize tasks when you have multiple deadlines?', category: 'Time Management', role: 'fullstack', difficulty: 'easy', type: 'behavioral', idealAnswer: 'Explain your prioritization framework: urgency vs importance matrix, impact analysis, stakeholder communication. Mention tools you use (task boards, calendars). Discuss how you handle unexpected urgent tasks and how you communicate timeline changes proactively.', tips: 'Give a specific example with measurable outcomes.' },
  { question: 'Describe a situation where you had to make a technical decision with limited information.', category: 'Decision Making', role: 'backend', difficulty: 'hard', type: 'behavioral', idealAnswer: 'Describe the scenario and constraints. Explain how you gathered available information, consulted experts, evaluated risks, and made a pragmatic decision. Discuss the outcome and whether you would make the same decision again. Show structured thinking under uncertainty.', tips: 'Emphasize your decision-making framework.' },

  // HR
  { question: 'Why do you want to work at our company?', category: 'Motivation', role: 'frontend', difficulty: 'easy', type: 'hr', idealAnswer: 'Research the company and align your answer with their mission, products, culture, and growth opportunities. Show genuine enthusiasm. Connect your skills and career goals with what the company offers. Mention specific projects or initiatives that excite you.', tips: 'Be specific about the company, not generic.' },
  { question: 'Where do you see yourself in 5 years?', category: 'Career Goals', role: 'backend', difficulty: 'easy', type: 'hr', idealAnswer: 'Show ambition while being realistic. Align your goals with growth opportunities at the company. Mention both technical growth (becoming an expert, leading architecture) and leadership growth (mentoring, team lead). Show that you think long-term and invest in your career.', tips: 'Balance ambition with realism.' },
  { question: 'What is your biggest strength and weakness?', category: 'Self-awareness', role: 'fullstack', difficulty: 'easy', type: 'hr', idealAnswer: 'Strength: Choose one relevant to the role with a specific example. Weakness: Choose a genuine weakness (not a disguised strength), show self-awareness, and explain what you are actively doing to improve. Show growth mindset and honesty.', tips: 'Be authentic, avoid cliches like "perfectionist".' },

  // System Design
  { question: 'How would you design a URL shortener service like bit.ly?', category: 'System Design', role: 'fullstack', difficulty: 'medium', type: 'system-design', idealAnswer: 'Components: API service, database, redirect service. URL encoding using base62 or hash function. Database schema: original URL, short code, user, click count, expiry. Handle collision with retry. Add caching layer (Redis) for popular URLs. Scale with load balancer and database sharding.', tips: 'Start with requirements, then high-level design, then deep dive.' },
  { question: 'Design a real-time chat application that supports group messaging.', category: 'System Design', role: 'fullstack', difficulty: 'hard', type: 'system-design', idealAnswer: 'Use WebSockets for real-time messaging. Components: API servers, WebSocket servers, message queue (Kafka), database (MongoDB for messages, Redis for presence). Handle offline users with push notifications and message queueing. Scale WebSocket servers with Redis pub/sub. End-to-end encryption for security.', tips: 'Discuss scalability, reliability, and security.' },
  { question: 'How would you design the backend for a food delivery application?', category: 'System Design', role: 'backend', difficulty: 'hard', type: 'system-design', idealAnswer: 'Microservices: User service, Restaurant service, Order service, Payment service, Delivery tracking service, Notification service. Database per service pattern. Event-driven architecture with message queues. Real-time tracking with WebSockets and geospatial queries. Handle high load during peak hours with auto-scaling and caching.', tips: 'Cover the entire flow from ordering to delivery.' },

  // Data Analyst
  { question: 'What is the difference between INNER JOIN, LEFT JOIN, RIGHT JOIN, and FULL OUTER JOIN?', category: 'SQL', role: 'data-analyst', difficulty: 'easy', type: 'technical', idealAnswer: 'INNER JOIN returns matching rows from both tables. LEFT JOIN returns all rows from left table plus matches from right (NULLs for non-matches). RIGHT JOIN is the opposite. FULL OUTER JOIN returns all rows from both tables with NULLs where no match exists.', tips: 'Use a Venn diagram mental model to explain.' },
  { question: 'Explain the concept of A/B testing and how you would design one.', category: 'Statistics', role: 'data-analyst', difficulty: 'medium', type: 'technical', idealAnswer: 'A/B testing compares two versions to determine which performs better. Steps: Define hypothesis and metric, calculate sample size, randomly assign users, run test for sufficient duration, analyze results with statistical significance (p-value < 0.05). Avoid peeking, ensure equal distribution, account for novelty effect.', tips: 'Mention common pitfalls and statistical concepts.' },

  // DevOps
  { question: 'Explain the CI/CD pipeline and its key stages.', category: 'CI/CD', role: 'devops', difficulty: 'easy', type: 'technical', idealAnswer: 'CI (Continuous Integration): developers merge code frequently, automated builds and tests run. CD (Continuous Delivery): code is always in a deployable state. CD (Continuous Deployment): automatic deployment to production. Key stages: Source, Build, Test (unit, integration, e2e), Deploy to staging, Deploy to production. Tools: Jenkins, GitHub Actions, GitLab CI.', tips: 'Discuss specific tools you have experience with.' },
  { question: 'What is containerization and how does Docker work?', category: 'Docker', role: 'devops', difficulty: 'medium', type: 'technical', idealAnswer: 'Containerization packages applications with their dependencies into isolated containers. Docker uses Linux kernel features (namespaces, cgroups) for isolation. Dockerfile defines the image, docker-compose orchestrates multi-container apps. Benefits: consistency across environments, lightweight compared to VMs, fast startup.', tips: 'Compare containers vs VMs and discuss practical use cases.' },

  // Product Manager
  { question: 'How would you prioritize features for a new product launch?', category: 'Prioritization', role: 'product-manager', difficulty: 'medium', type: 'technical', idealAnswer: 'Use frameworks like RICE (Reach, Impact, Confidence, Effort), MoSCoW (Must have, Should have, Could have, Won\'t have), or Value vs Effort matrix. Gather input from stakeholders, users, and data. Align priorities with business goals and user needs. Create a clear roadmap with milestones.', tips: 'Show familiarity with multiple frameworks.' },

  // More Frontend
  { question: 'What is TypeScript and why would you use it over JavaScript?', category: 'TypeScript', role: 'frontend', difficulty: 'easy', type: 'technical', idealAnswer: 'TypeScript is a typed superset of JavaScript that compiles to plain JavaScript. Benefits: catch errors at compile time, better IDE support, improved refactoring, self-documenting code, interfaces for contracts. Trade-offs: learning curve, compilation step, some library typing issues.', tips: 'Give specific examples of bugs TypeScript catches.' },
  { question: 'Explain the concept of state management in React. Compare Context API, Redux, and Zustand.', category: 'React', role: 'frontend', difficulty: 'medium', type: 'technical', idealAnswer: 'Context API: built-in, good for simple global state but causes unnecessary re-renders. Redux: predictable state container with strict patterns, middleware support, great DevTools. Zustand: lightweight, minimal boilerplate, hook-based, performant with selective subscriptions. Choose based on app complexity and team preferences.', tips: 'Discuss when to use each and their performance implications.' },
  { question: 'How do you ensure accessibility (a11y) in web applications?', category: 'Accessibility', role: 'frontend', difficulty: 'medium', type: 'technical', idealAnswer: 'Semantic HTML, ARIA attributes, keyboard navigation, focus management, color contrast (WCAG 2.1), screen reader testing, alt text for images, form labels, skip navigation links. Tools: axe, Lighthouse, screen readers (NVDA, VoiceOver). Follow WCAG 2.1 AA guidelines minimum.', tips: 'Show practical experience with testing tools.' },

  // More Backend
  { question: 'What is database indexing and how does it affect query performance?', category: 'Databases', role: 'backend', difficulty: 'medium', type: 'technical', idealAnswer: 'Indexes are data structures (B-tree, hash) that speed up data retrieval by allowing the database to find rows without scanning the entire table. They improve read performance but slow down writes. Types: single-field, compound, unique, text, geospatial. Use EXPLAIN to analyze query plans and optimize indexes.', tips: 'Discuss when NOT to use indexes.' },
  { question: 'Explain the concept of caching and different caching strategies.', category: 'Performance', role: 'backend', difficulty: 'medium', type: 'technical', idealAnswer: 'Caching stores frequently accessed data in faster storage. Strategies: Cache-aside (lazy loading), Write-through (sync write), Write-behind (async write), Read-through. Levels: Browser cache, CDN, Application cache (Redis), Database query cache. Invalidation strategies: TTL, event-based, versioning.', tips: 'Discuss cache invalidation challenges.' },
];

async function seedQuestions() {
  try {
    await mongoose.connect(process.env.MONGODB_URI);
    console.log('Connected to MongoDB');

    await Question.deleteMany({});
    console.log('Cleared existing questions');

    await Question.insertMany(questions);
    console.log(`Seeded ${questions.length} questions`);

    await mongoose.disconnect();
    console.log('Done!');
    process.exit(0);
  } catch (error) {
    console.error('Seed error:', error);
    process.exit(1);
  }
}

seedQuestions();
